# Kiro to Claude API è½¬æ¢æœåŠ¡ - é¡¹ç›®è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®å°† Kiro AI çš„å¯¹è¯æ¥å£å°è£…æˆæ ‡å‡†çš„ Claude API æ ¼å¼ï¼Œè®©ä»»ä½•æ”¯æŒ Claude API çš„åº”ç”¨éƒ½èƒ½ä½¿ç”¨ Kiro æœåŠ¡ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **API æ ¼å¼è½¬æ¢** - å°† Claude API è¯·æ±‚è½¬æ¢ä¸º Kiro API è°ƒç”¨
2. **æ¨¡å‹ ID æ˜ å°„** - è‡ªåŠ¨è½¬æ¢ Claude æ¨¡å‹ ID åˆ° Kiro æ¨¡å‹ ID
3. **æµå¼å“åº”æ”¯æŒ** - æ”¯æŒ SSE æµå¼è¾“å‡º
4. **å¤šè½®å¯¹è¯** - æ”¯æŒä¸Šä¸‹æ–‡å¯¹è¯
5. **é…ç½®åŒ–ç®¡ç†** - é€šè¿‡ JSON æ–‡ä»¶ç®¡ç†æ¨¡å‹æ˜ å°„

## ğŸ“ æ–‡ä»¶ç»“æ„

```
TestSimple/
â”œâ”€â”€ claude-api-server.js       # ä¸»æœåŠ¡å™¨ç¨‹åºï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ model-mapping.json         # æ¨¡å‹ ID æ˜ å°„é…ç½®
â”œâ”€â”€ manage-models.js           # æ¨¡å‹æ˜ å°„ç®¡ç†å·¥å…·
â”œâ”€â”€ test-claude-api.js         # API æµ‹è¯•è„šæœ¬
â”œâ”€â”€ test-multiturn.js          # å¤šè½®å¯¹è¯æµ‹è¯•
â”‚
â”œâ”€â”€ KiroClient.js              # Kiro API å®¢æˆ·ç«¯
â”œâ”€â”€ loadToken.js               # Token åŠ è½½å·¥å…·
â”œâ”€â”€ example.js                 # Kiro å®¢æˆ·ç«¯ç¤ºä¾‹
â”‚
â”œâ”€â”€ CLAUDE_API_README.md       # Claude API å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ æ¨¡å‹æ˜ å°„è¯´æ˜.md             # æ¨¡å‹æ˜ å°„è¯¦ç»†è¯´æ˜
â”œâ”€â”€ å¿«é€Ÿå¼€å§‹.md                 # å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
â”œâ”€â”€ é¡¹ç›®è¯´æ˜.md                 # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ package.json               # é¡¹ç›®é…ç½®
â”œâ”€â”€ kiro-auth-token.json       # Kiro è®¤è¯ Token
â””â”€â”€ README.md                  # Kiro å®¢æˆ·ç«¯æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
node claude-api-server.js
```

### 2. æµ‹è¯• API

```bash
node test-claude-api.js
```

### 3. æŸ¥çœ‹æ¨¡å‹æ˜ å°„

```bash
npm run models
# æˆ–
node manage-models.js show
```

## ğŸ”§ æ¨¡å‹æ˜ å°„ç®¡ç†

### æŸ¥çœ‹å½“å‰æ˜ å°„

```bash
node manage-models.js show
```

### æŸ¥çœ‹ Kiro æ”¯æŒçš„æ¨¡å‹

```bash
node manage-models.js list
```

### æ·»åŠ æ–°æ˜ å°„

```bash
node manage-models.js add "claude-3-5-sonnet-20260101" "claude-sonnet-4.5"
```

### æµ‹è¯•æ˜ å°„

```bash
node manage-models.js test "claude-3-5-haiku-latest"
```

### åˆ é™¤æ˜ å°„

```bash
node manage-models.js remove "claude-3-5-sonnet-20260101"
```

## ğŸ“ API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/v1/messages` | POST | å‘é€æ¶ˆæ¯ï¼ˆå…¼å®¹ Claude APIï¼‰ |
| `/v1/models` | GET | è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨ |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

## ğŸ”„ æ¨¡å‹æ˜ å°„å·¥ä½œæµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
claude-3-5-sonnet-20241022
    â†“
[model-mapping.json æŸ¥æ‰¾]
    â†“
claude-sonnet-4.5
    â†“
Kiro API è°ƒç”¨
    â†“
è¿”å›ç»“æœ
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ›¿æ¢ç°æœ‰ Claude API

å¦‚æœä½ æœ‰ä¸€ä¸ªä½¿ç”¨ Claude API çš„åº”ç”¨ï¼š

```javascript
// åŸæ¥çš„ä»£ç 
const response = await fetch('https://api.anthropic.com/v1/messages', {
  method: 'POST',
  headers: {
    'x-api-key': 'sk-ant-...',
    'anthropic-version': '2023-06-01',
    'content-type': 'application/json'
  },
  body: JSON.stringify({
    model: 'claude-3-5-sonnet-20241022',
    messages: [{ role: 'user', content: 'ä½ å¥½' }]
  })
});

// åªéœ€ä¿®æ”¹ URL
const response = await fetch('http://localhost:3000/v1/messages', {
  method: 'POST',
  headers: {
    'content-type': 'application/json'
  },
  body: JSON.stringify({
    model: 'claude-3-5-sonnet-20241022',  // è‡ªåŠ¨æ˜ å°„
    messages: [{ role: 'user', content: 'ä½ å¥½' }]
  })
});
```

### åœºæ™¯ 2: ä½¿ç”¨ Claude SDK

```javascript
import Anthropic from '@anthropic-ai/sdk';

const client = new Anthropic({
  apiKey: 'dummy-key',  // ä¸éœ€è¦çœŸå® key
  baseURL: 'http://localhost:3000'  // æŒ‡å‘æœ¬åœ°æœåŠ¡
});

const message = await client.messages.create({
  model: 'claude-3-5-sonnet-20241022',
  max_tokens: 1024,
  messages: [{ role: 'user', content: 'ä½ å¥½' }]
});
```

### åœºæ™¯ 3: é›†æˆåˆ°ç°æœ‰å·¥å…·

å¾ˆå¤šå·¥å…·æ”¯æŒè‡ªå®šä¹‰ API ç«¯ç‚¹ï¼Œä¾‹å¦‚ï¼š

- **Continue.dev** - VS Code AI åŠ©æ‰‹
- **Cursor** - AI ä»£ç ç¼–è¾‘å™¨
- **Open WebUI** - èŠå¤©ç•Œé¢
- **LangChain** - AI åº”ç”¨æ¡†æ¶

åªéœ€åœ¨é…ç½®ä¸­è®¾ç½®ï¼š
- API Base URL: `http://localhost:3000`
- Model: `claude-3-5-sonnet-20241022`ï¼ˆæˆ–ä»»ä½•æ˜ å°„çš„æ¨¡å‹ï¼‰

## ğŸ¨ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `claude-api-server.js`ï¼š

```javascript
const PORT = process.env.PORT || 3000;
```

æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
PORT=8080 node claude-api-server.js
```

### ä¿®æ”¹é»˜è®¤æ¨¡å‹

ç¼–è¾‘ `model-mapping.json`ï¼š

```json
{
  "defaultModel": "claude-haiku-4.5"
}
```

### æ·»åŠ è®¤è¯

åœ¨ `claude-api-server.js` ä¸­æ·»åŠ ä¸­é—´ä»¶ï¼š

```javascript
app.use((req, res, next) => {
  const apiKey = req.headers['x-api-key'];
  if (!apiKey || apiKey !== process.env.API_KEY) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  next();
});
```

## ğŸ“Š æ¨¡å‹é€‰æ‹©å»ºè®®

| æ¨¡å‹ | Kiro ID | è´¹ç‡ | é€‚ç”¨åœºæ™¯ |
|------|---------|------|----------|
| Haiku | `claude-haiku-4.5` | 0.4x | ç®€å•é—®ç­”ã€ä»£ç å®¡æŸ¥ |
| Sonnet | `claude-sonnet-4.5` | 1.3x | å¤æ‚ä»£ç ç”Ÿæˆã€æ¶æ„è®¾è®¡ |
| Opus | `claude-opus-4.5` | 2.2x | é«˜éš¾åº¦ç®—æ³•ã€ç ”ç©¶çº§é—®é¢˜ |
| Simple Task | `simple-task` | 0.3x | ç¿»è¯‘ã€æ ¼å¼è½¬æ¢ |
| Auto | `auto` | 1.0x | è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰ |

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡å™¨å¯åŠ¨å¤±è´¥

```
âŒ Kiro å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: Token åŠ è½½å¤±è´¥
```

**è§£å†³ï¼š** ç¡®ä¿ `kiro-auth-token.json` å­˜åœ¨ä¸”åŒ…å«æœ‰æ•ˆ Token

### é—®é¢˜ 2: æ¨¡å‹æ˜ å°„å¤±è´¥

```
[æ¨¡å‹æ˜ å°„] claude-xxx -> claude-sonnet-4.5 (é»˜è®¤)
API Error 400 Bad Request
```

**è§£å†³ï¼š**
1. è¿è¡Œ `node manage-models.js list` æŸ¥çœ‹ Kiro æ”¯æŒçš„æ¨¡å‹
2. è¿è¡Œ `node manage-models.js test "æ¨¡å‹ID"` æµ‹è¯•æ˜ å°„
3. æ·»åŠ æ­£ç¡®çš„æ˜ å°„åˆ° `model-mapping.json`

### é—®é¢˜ 3: å¤šè½®å¯¹è¯å¤±è´¥

**è§£å†³ï¼š** ç¡®ä¿å†å²æ¶ˆæ¯æ ¼å¼æ­£ç¡®ï¼Œå¿…é¡»æ˜¯æˆå¯¹çš„ user/assistant æ¶ˆæ¯

### é—®é¢˜ 4: æµå¼å“åº”ä¸å·¥ä½œ

**è§£å†³ï¼š** ç¡®ä¿å®¢æˆ·ç«¯æ­£ç¡®å¤„ç† SSE æ ¼å¼ï¼Œè®¾ç½® `stream: true`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹.md](./å¿«é€Ÿå¼€å§‹.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [CLAUDE_API_README.md](./CLAUDE_API_README.md) - API å®Œæ•´æ–‡æ¡£
- [æ¨¡å‹æ˜ å°„è¯´æ˜.md](./æ¨¡å‹æ˜ å°„è¯´æ˜.md) - æ¨¡å‹æ˜ å°„è¯¦ç»†è¯´æ˜
- [README.md](./README.md) - Kiro å®¢æˆ·ç«¯æ–‡æ¡£

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¸è¦æš´éœ²åˆ°å…¬ç½‘** - è¿™ä¸ªæœåŠ¡å™¨æ²¡æœ‰è®¤è¯æœºåˆ¶
2. **ä½¿ç”¨åå‘ä»£ç†** - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Nginx/Caddy
3. **æ·»åŠ é€Ÿç‡é™åˆ¶** - é˜²æ­¢æ»¥ç”¨
4. **ä¿æŠ¤ Token** - ä¸è¦æäº¤åˆ° Git

## ğŸš€ ç”Ÿäº§éƒ¨ç½²

### ä½¿ç”¨ PM2

```bash
npm install -g pm2
pm2 start claude-api-server.js --name kiro-api
pm2 save
pm2 startup
```

### ä½¿ç”¨ Docker

åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["node", "claude-api-server.js"]
```

æ„å»ºå’Œè¿è¡Œï¼š

```bash
docker build -t kiro-claude-api .
docker run -p 3000:3000 -v $(pwd)/kiro-auth-token.json:/app/kiro-auth-token.json kiro-claude-api
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **å¯ç”¨ç¼“å­˜** - ç¼“å­˜å¸¸è§è¯·æ±‚
2. **è¿æ¥æ± ** - å¤ç”¨ HTTP è¿æ¥
3. **è´Ÿè½½å‡è¡¡** - å¤šå®ä¾‹éƒ¨ç½²
4. **ç›‘æ§æ—¥å¿—** - ä½¿ç”¨ Winston/Pino

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT

## ğŸ™ è‡´è°¢

- Kiro AI - æä¾›åº•å±‚ API
- Anthropic - Claude API è®¾è®¡å‚è€ƒ
